<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°©íƒˆì¶œ: í”„ë¡œì íŠ¸ í‚¤ë©”ë¼ (ë¡œì§ ìˆ˜ì • ë²„ì „)</title>
    <!-- ì¤‘ìš”: ì´ íŒŒì¼ì€ VS Codeì˜ 'Live Server'ë¡œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤. -->
    <style>
        :root { --highlight-color: rgba(255, 255, 0, 0.8); }
        body { background-color: #000; color: #eee; font-family: 'Malgun Gothic', 'Segoe UI', sans-serif; margin: 0; overflow: hidden; }
        .screen { width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; flex-direction: column; position: absolute; top: 0; left: 0; transition: opacity 0.5s ease-in-out; z-index: 10; }
        .hidden { opacity: 0; pointer-events: none; z-index: 0; }
        .start-box, .end-box { background-color: rgba(10, 10, 10, 0.9); padding: 40px; border: 1px solid #444; border-radius: 10px; text-align: center; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .start-box h1, .end-box h1 { color: #f00; text-shadow: 0 0 5px #f00; margin-top: 0; }
        .start-box input { display: block; margin: 10px auto; width: 250px; padding: 10px; background-color: #222; border: 1px solid #555; color: #fff; border-radius: 5px; }
        .start-box button, .end-box button { padding: 12px 30px; margin-top: 20px; font-size: 16px; cursor: pointer; background-color: #f00; color: #fff; border: none; border-radius: 5px; }
        #game-screen-wrapper { z-index: 5; }
        #game-ui { width: 1280px; padding: 10px 0; display: flex; justify-content: space-between; font-size: 24px; font-weight: bold; }
        #stage-display { color: #fff; text-shadow: 1px 1px 3px #000; }
        #timer-display { color: #f00; text-shadow: 1px 1px 3px #000; }
        #game-container { width: 1280px; height: 720px; border: 3px solid #555; background-size: cover; background-position: center; position: relative; transition: background-image 0.5s ease-in-out; }
        .hotspot { position: absolute; box-sizing: border-box; cursor: pointer; transition: all 0.3s ease; }
        .hotspot:hover { box-shadow: 0 0 20px 5px var(--highlight-color); border: 2px dashed var(--highlight-color); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.75); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: #1a1a1a; padding: 20px 30px; border: 1px solid #555; border-radius: 8px; width: 90%; max-width: 500px; position: relative; }
        .modal-content.wide { max-width: 640px; }
        .close-button { position: absolute; top: 10px; right: 20px; font-size: 32px; color: #888; cursor: pointer; line-height: 1; }
        .close-button:hover { color: #fff; }
        .modal-content h2 { margin-top: 0; color: var(--highlight-color); }
        .modal-content input { width: 80%; padding: 10px; margin: 10px auto; display: block; background: #333; border: 1px solid #666; color: #fff; border-radius: 4px; }
        .modal-content button { padding: 10px 20px; cursor: pointer; background: #555; border: 1px solid #888; color: #fff; border-radius: 4px; }
        #memory-game-board { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 20px; }
        .memory-card { width: 120px; height: 120px; background-color: transparent; perspective: 1000px; cursor: pointer; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .memory-card.flipped .card-inner { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; justify-content: center; align-items: center; font-size: 50px; border-radius: 8px; }
        .card-front { background: #333; color: var(--highlight-color); }
        .card-back { background: #5055b1; color: #fff; transform: rotateY(180deg); }
        .memory-card.matched { cursor: default; opacity: 0.5; }
    </style>
</head>
<body>
    <!-- HTML êµ¬ì¡° (ìˆ˜ì • ì—†ìŒ) -->
    <div id="start-screen" class="screen">
        <div class="start-box"><h1>í”„ë¡œì íŠ¸ í‚¤ë©”ë¼: ë¡ë‹¤ìš´</h1><p>ì—°êµ¬ì†Œ ë¹„ìƒì‚¬íƒœ ë°œìƒ. ì‹œìŠ¤í…œì´ ìí­í•˜ê¸° ì „ì— íƒˆì¶œí•´ì•¼ í•œë‹¤.</p><input type="text" id="user-grade" placeholder="í•™ë…„ (ì˜ˆ: 1)"><input type="text" id="user-class" placeholder="ë°˜ (ì˜ˆ: 3)"><input type="text" id="user-name" placeholder="ì´ë¦„ (ì˜ˆ: í™ê¸¸ë™)"><button id="start-game-btn">ê²Œì„ ì‹œì‘</button></div>
    </div>
    <div id="game-screen-wrapper" class="screen hidden"><div id="game-ui"><span id="stage-display"></span><span id="timer-display"></span></div><div id="game-container"></div></div>
    <div id="end-screen" class="screen hidden"><div class="end-box"><h1>ESCAPE SUCCESSFUL</h1><p><span id="final-user-info"></span> í•™ìƒ,</p><p>ì—°êµ¬ì†Œë¥¼ ë¬´ì‚¬íˆ íƒˆì¶œí–ˆìŠµë‹ˆë‹¤!</p><p>ì´ ê±¸ë¦° ì‹œê°„: <span id="final-time"></span></p><button onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button></div></div>
    <div id="info-modal" class="modal-overlay hidden"><div class="modal-content"><span class="close-button">Ã—</span><h2 id="info-title"></h2><p id="info-text" style="white-space: pre-wrap;"></p><div id="problem-input-area" class="hidden" style="text-align: center;"><input type="text" id="problem-answer" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”"><button id="submit-problem-btn">í™•ì¸</button></div></div></div>
    <div id="minigame-modal" class="modal-overlay hidden"><div class="modal-content wide"><span class="close-button">Ã—</span><h2>ë¯¸ë‹ˆê²Œì„: ë©”ëª¨ë¦¬ ì¹´ë“œ</h2><p>ê°™ì€ ìŒì˜ ì¹´ë“œë¥¼ ëª¨ë‘ ì°¾ìœ¼ì„¸ìš”. ì™„ë£Œí•˜ë©´ íŒíŠ¸ë¥¼ ì–»ìŠµë‹ˆë‹¤.</p><div id="memory-game-board"></div></div></div>
    <div id="password-modal" class="modal-overlay hidden"><div class="modal-content" style="text-align: center;"><span class="close-button">Ã—</span><h2 id="password-title">íƒˆì¶œêµ¬ ì ê¸ˆ í•´ì œ</h2><p>ì´ êµ¬ì—­ì„ íƒˆì¶œí•˜ê¸° ìœ„í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì‹­ì‹œì˜¤.</p><input type="text" id="password-answer" placeholder="íƒˆì¶œ ë¹„ë°€ë²ˆí˜¸"><button id="submit-password-btn">íƒˆì¶œ</button></div></div>

    <script>
    // === JAVASCRIPT (ê²Œì„ ë¡œì§ ìˆ˜ì • ë²„ì „) ===
    document.addEventListener('DOMContentLoaded', () => {
        const startScreen = document.getElementById('start-screen');
        const gameScreenWrapper = document.getElementById('game-screen-wrapper');
        const endScreen = document.getElementById('end-screen');
        const startGameBtn = document.getElementById('start-game-btn');
        const userGradeInput = document.getElementById('user-grade');
        const userClassInput = document.getElementById('user-class');
        const userNameInput = document.getElementById('user-name');
        const stageDisplay = document.getElementById('stage-display');
        const timerDisplay = document.getElementById('timer-display');
        const gameContainer = document.getElementById('game-container');
        const finalUserInfo = document.getElementById('final-user-info');
        const finalTime = document.getElementById('final-time');
        const infoModal = document.getElementById('info-modal');
        const minigameModal = document.getElementById('minigame-modal');
        const passwordModal = document.getElementById('password-modal');
        const allModals = [infoModal, minigameModal, passwordModal];
        let userInfo = {}, currentStage = 0, timerInterval, startTime, activeHotspot = null, gameData = [];

        // ê²Œì„ ë°ì´í„° ì •ì˜ (í•«ìŠ¤íŒŸ êµ¬ì¡° ë³€ê²½)
        const gameDefinition = [
            { // ìŠ¤í…Œì´ì§€ 1
                stage: 1, backgroundImage: 'url(stage1.jpg)', exitPassword: '461', 
                puzzles: { monitor: false, calendar: false, drawer_minigame: false },
                // **ìˆ˜ì •**: exit í•«ìŠ¤íŒŸì„ ì œê±°í•˜ê³ , ì„œëì€ minigame ê¸°ëŠ¥ë§Œ í•˜ë„ë¡ ë³€ê²½
                hotspots: [
                    { id: 'monitor', type: 'problem', title: 'ì»´í“¨í„° í™”ë©´ ë¬¸ì œ', text: 'ì»´í“¨í„° í™”ë©´ì— ìˆ˜í•™ ë¬¸ì œê°€ í‘œì‹œë˜ì–´ ìˆë‹¤.\n\n3.5 x 0.8 + 1.2 = ?', answer: '4', reward: 'ì •ë‹µ!\níƒˆì¶œêµ¬ ë¹„ë°€ë²ˆí˜¸ì˜ ì²« ë²ˆì§¸ ìë¦¬ ìˆ«ìëŠ” [ 4 ] ì…ë‹ˆë‹¤.', pos: { x: 37.1, y: 38.3, w: 26.6, h: 26.5 } },
                    { id: 'pc_body', type: 'hint', title: 'PC ë³¸ì²´', text: 'PC ë³¸ì²´ì—ì„œ "ë¬¸ì œë¥¼ í’€ì–´ ì•”í˜¸ë¥¼ ì™„ì„±í•˜ë¼"ëŠ” ë©”ëª¨ë¥¼ ë°œê²¬í–ˆë‹¤.', pos: { x: 65, y: 46.5, w: 10.5, h: 41.3 } },
                    { id: 'calendar', type: 'problem', title: 'ë²½ê±¸ì´ ë‹¬ë ¥ ë¬¸ì œ', text: 'ë‹¬ë ¥ ë’·ë©´ì— ë¹„ì™€ ë¹„ìœ¨ ë¬¸ì œê°€ ì í˜€ìˆë‹¤.\n\n2 : 5 = â–¡ : 15\n\në„¤ëª¨(â–¡) ì•ˆì— ë“¤ì–´ê°ˆ ìˆ˜ëŠ”?', answer: '6', reward: 'ì •ë‹µ!\níƒˆì¶œêµ¬ ë¹„ë°€ë²ˆí˜¸ì˜ ë‘ ë²ˆì§¸ ìë¦¬ ìˆ«ìëŠ” [ 6 ] ì…ë‹ˆë‹¤.', pos: { x: 12.1, y: 30, w: 10.9, h: 18.2 } },
                    { id: 'drawer_minigame', type: 'minigame', title: 'ì„œë í¼ì¦', text: 'ì„œëì„ ì—´ì ì´ìƒí•œ ì¥ì¹˜ê°€ ë‚˜íƒ€ë‚¬ë‹¤. íŒ¨í„´ì„ ë§ì¶°ì•¼ ì—´ë¦´ ê²ƒ ê°™ë‹¤.', symbols: ['ğŸ’»', 'ğŸ“…', 'âŒ¨ï¸', 'ğŸ–±ï¸', 'ğŸ”Œ', 'ğŸ”¬'], reward: 'ë¯¸ë‹ˆê²Œì„ í•´ê²°!\nì„œë ì•ˆì—ì„œ ìª½ì§€ë¥¼ ë°œê²¬í–ˆë‹¤: "íƒˆì¶œêµ¬ ë¹„ë°€ë²ˆí˜¸ì˜ ì„¸ ë²ˆì§¸ ìë¦¬ ìˆ«ìëŠ” [ 1 ] ì…ë‹ˆë‹¤."', pos: { x: 77.2, y: 53.5, w: 22, h: 45 } }
                ]
            },
            // ë‚˜ë¨¸ì§€ ìŠ¤í…Œì´ì§€ ë°ì´í„°ëŠ” ë™ì¼ (ê°„ê²°í•¨ì„ ìœ„í•´ ìƒëµ)
            { stage: 2, backgroundImage: 'url(stage2.jpg)', exitPassword: '370', puzzles: { blackboard: false, lights: false, server_minigame: false }, hotspots: [ { id: 'blackboard', type: 'problem', title: 'ì¹ íŒ ë¬¸ì œ', text: 'ì¹ íŒì— ì›ì˜ ë„“ì´ë¥¼ êµ¬í•˜ëŠ” ë¬¸ì œê°€ ìˆë‹¤.\n(ì›ì£¼ìœ¨ì€ 3ìœ¼ë¡œ ê³„ì‚°í•˜ì‹œì˜¤)\n\në°˜ì§€ë¦„ì´ 10cmì¸ ì›ì˜ ë„“ì´ëŠ” ëª‡ cmÂ² ì…ë‹ˆê¹Œ?', answer: '300', reward: 'ì •ë‹µ!\ní•´ì¹˜ ë¹„ë°€ë²ˆí˜¸ì˜ ì²« ë²ˆì§¸ ìë¦¬ ìˆ«ìëŠ” [ 3 ] ì…ë‹ˆë‹¤.', pos: { x: 35.3, y: 34.6, w: 29.3, h: 21.3 } }, { id: 'lights', type: 'problem', title: 'ì¡°ëª… ì† ìª½ì§€', text: 'ê¹œë¹¡ì´ëŠ” ì¡°ëª… ë®ê°œ ì•ˆì—ì„œ ìª½ì§€ë¥¼ ë°œê²¬í–ˆë‹¤.\n\nì‹œì† 90kmë¡œ ë‹¬ë¦¬ëŠ” ìë™ì°¨ê°€ 3ì‹œê°„ ë™ì•ˆ ì´ë™í•œ ê±°ë¦¬ëŠ” ëª‡ km ì…ë‹ˆê¹Œ?', answer: '270', reward: 'ì •ë‹µ!\ní•´ì¹˜ ë¹„ë°€ë²ˆí˜¸ì˜ ë‘ ë²ˆì§¸ ìë¦¬ ìˆ«ìëŠ” [ 7 ] ì…ë‹ˆë‹¤.', pos: { x: 30, y: 0.5, w: 40, h: 11.5 } }, { id: 'wires', type: 'hint', title: 'ë°”ë‹¥ì˜ ì „ì„ ë“¤', text: 'ì „ì„  ë­‰ì¹˜ì—ì„œ "ì„œë²„ë¥¼ ì ê²€í•˜ê³  ì¹ íŒê³¼ ì¡°ëª…ì„ í™•ì¸í•˜ë¼"ëŠ” ìª½ì§€ë¥¼ ë°œê²¬í–ˆë‹¤.', pos: { x: 4.8, y: 65.5, w: 90.3, h: 30.5 } }, { id: 'server_minigame', type: 'minigame', title: 'ì„œë²„ ì ê²€ íŒ¨ë„', text: 'ì„œë²„ í•˜ë‚˜ë¥¼ ì—´ì ì ê²€ íŒ¨ë„ì´ ë‚˜ì™”ë‹¤. ìŒì„ ë§ì¶° ì‹œìŠ¤í…œì„ í™œì„±í™”í•˜ì.', symbols: ['ğŸŒ', 'ğŸ”’', 'ğŸ”‘', 'ğŸ’¾', 'âš™ï¸', 'âš¡ï¸'], reward: 'ì‹œìŠ¤í…œ í™œì„±í™”!\níŒ¨ë„ í™”ë©´ì— ê¸€ìê°€ ë‚˜íƒ€ë‚¬ë‹¤: "í•´ì¹˜ ë¹„ë°€ë²ˆí˜¸ì˜ ì„¸ ë²ˆì§¸ ìë¦¬ ìˆ«ìëŠ” [ 0 ] ì…ë‹ˆë‹¤."', pos: { x: 4.8, y: 15.5, w: 16.3, h: 80.3 } } ] },
            { stage: 3, backgroundImage: 'url(stage3.jpg)', exitPassword: '159', puzzles: { beaker: false, microscope: false, machine_minigame: false }, hotspots: [ { id: 'beaker', type: 'problem', title: 'ë¹„ì»¤ ì˜† ë©”ëª¨', text: 'ë¹„ì»¤ ì˜†ì— ì§ìœ¡ë©´ì²´ì˜ ë¶€í”¼ë¥¼ êµ¬í•˜ëŠ” ë¬¸ì œê°€ ì íŒ ë©”ëª¨ê°€ ìˆë‹¤.\n\nê°€ë¡œ 5cm, ì„¸ë¡œ 4cm, ë†’ì´ 8cmì¸ ì§ìœ¡ë©´ì²´ì˜ ë¶€í”¼ëŠ” ëª‡ cmÂ³ ì…ë‹ˆê¹Œ?', answer: '160', reward: 'ì •ë‹µ!\nì—°êµ¬ì‹¤ ë¬¸ ë¹„ë°€ë²ˆí˜¸ì˜ ì²« ë²ˆì§¸ ìë¦¬ ìˆ«ìëŠ” [ 1 ] ì…ë‹ˆë‹¤.', pos: { x: 11.5, y: 26, w: 4, h: 11 } }, { id: 'microscope', type: 'problem', title: 'í˜„ë¯¸ê²½ ë Œì¦ˆ', text: 'í˜„ë¯¸ê²½ ë Œì¦ˆì— ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ ë¬¸ì œê°€ ìƒˆê²¨ì ¸ ìˆë‹¤.\n\n12.5 Ã· 2.5 = ?', answer: '5', reward: 'ì •ë‹µ!\nì—°êµ¬ì‹¤ ë¬¸ ë¹„ë°€ë²ˆí˜¸ì˜ ë‘ ë²ˆì§¸ ìë¦¬ ìˆ«ìëŠ” [ 5 ] ì…ë‹ˆë‹¤.', pos: { x: 80, y: 64.6, w: 16, h: 32 } }, { id: 'coat', type: 'hint', title: 'ì—°êµ¬ì› ê°€ìš´', text: 'ê°€ìš´ ì£¼ë¨¸ë‹ˆì—ì„œ "ì‹¤í—˜ ë„êµ¬ë“¤ì— í•´ë‹µì´ ìˆë‹¤." ë¼ëŠ” ë©”ëª¨ë¥¼ ë°œê²¬í–ˆë‹¤.', pos: { x: 74.3, y: 22, w: 13.9, h: 40 } }, { id: 'machine_minigame', type: 'minigame', title: 'ì•½í’ˆ í˜¼í•© ê¸°ê³„', text: 'ë³µì¡í•œ ê¸°ê³„ë‹¤. ì•„ë§ˆë„ ì‹œìŠ¤í…œì„ ì•ˆì •í™” ì‹œì¼œì•¼ ì‘ë™í•  ê²ƒ ê°™ë‹¤.', symbols: ['ğŸ’§', 'ğŸ”¥', 'ğŸ§ª', 'ğŸ’¨', 'ğŸ’Š', 'ğŸ§¬'], reward: 'ì‹œìŠ¤í…œ ì•ˆì •í™”!\nê¸°ê³„ í™”ë©´ì— ë¬¸êµ¬ê°€ í‘œì‹œëœë‹¤: "ì—°êµ¬ì‹¤ ë¬¸ ë¹„ë°€ë²ˆí˜¸ì˜ ì„¸ ë²ˆì§¸ ìë¦¬ ìˆ«ìëŠ” [ 9 ] ì…ë‹ˆë‹¤."', pos: { x: 44.4, y: 39, w: 23, h: 48 } } ] },
            { stage: 4, backgroundImage: 'url(stage4.jpg)', exitPassword: '825', puzzles: { main_core: false, monitor: false, panel_minigame: false }, hotspots: [ { id: 'main_core', type: 'problem', title: 'ì—ë„ˆì§€ ì½”ì–´ ë¶„ì„', text: 'ì½”ì–´ì˜ ì—ë„ˆì§€ íŒŒë™ì„ ë¶„ì„í•˜ë‹ˆ íŒ¨í„´ì´ ë³´ì¸ë‹¤.\n\n1, 2, 4, ?, 16, 32 ...\n\në¬¼ìŒí‘œì— ë“¤ì–´ê°ˆ ìˆ«ìëŠ”?', answer: '8', reward: 'ë¶„ì„ ì™„ë£Œ!\nì²œì¥ íƒˆì¶œêµ¬ ë¹„ë°€ë²ˆí˜¸ì˜ ì²« ë²ˆì§¸ ìë¦¬ ìˆ«ìëŠ” [ 8 ] ì…ë‹ˆë‹¤.', pos: { x: 27, y: 10, w: 46.5, h: 63 } }, { id: 'monitor', type: 'problem', title: 'ì œì–´íŒ ëª¨ë‹ˆí„°', text: 'ëª¨ë‹ˆí„°ì— ì‹œìŠ¤í…œ ì—ëŸ¬ ì½”ë“œê°€ ë–  ìˆë‹¤.\n\n[ Error Code: 0.4 x 5.5 = ? ]', answer: '2.2', reward: 'ì—ëŸ¬ ì½”ë“œ ë¶„ì„ ì™„ë£Œ!\nì²œì¥ íƒˆì¶œêµ¬ ë¹„ë°€ë²ˆí˜¸ì˜ ë‘ ë²ˆì§¸ ìë¦¬ ìˆ«ìëŠ” [ 2 ] ì…ë‹ˆë‹¤.', pos: { x: 37, y: 76.5, w: 26.5, h: 14.5 } }, { id: 'panel_minigame', type: 'minigame', title: 'ì œì–´íŒ', text: 'ì œì–´íŒì´ ì ê²¨ìˆë‹¤. ë©”ëª¨ë¦¬ í¼ì¦ì„ í’€ì–´ í•´ì œí•´ì•¼ í•œë‹¤.', symbols: ['âš ï¸', 'ğŸš¨', 'â›”ï¸', 'âœ…', 'âš¡ï¸', 'ğŸ”‹'], reward: 'ì œì–´íŒ ì ê¸ˆ í•´ì œ!\n"ì²œì¥ íƒˆì¶œêµ¬ ë¹„ë°€ë²ˆí˜¸ì˜ ì„¸ ë²ˆì§¸ ìë¦¬ ìˆ«ìëŠ” [ 5 ] ì…ë‹ˆë‹¤." ë¼ëŠ” íŒíŠ¸ê°€ ë‚˜íƒ€ë‚¬ë‹¤.', pos: { x: 27, y: 68.4, w: 45.3, h: 20 } } ] },
            { stage: 5, backgroundImage: 'url(stage5.jpg)', exitPassword: '630', puzzles: { main_screen: false, main_console: false, clock_minigame: false }, hotspots: [ { id: 'main_console', type: 'problem', title: 'ì£¼ ì œì–´ ì½˜ì†”', text: 'ì½˜ì†”ì„ ì¡°ì‘í•˜ë‹ˆ ì•”í˜¸ ë¬¸ì œ í•˜ë‚˜ê°€ ë‚˜íƒ€ë‚¬ë‹¤.\n\ní•œ ë³€ì˜ ê¸¸ì´ê°€ 6cmì¸ ì •ì‚¬ê°í˜•ì˜ ë„“ì´ëŠ” ëª‡ cmÂ² ì…ë‹ˆê¹Œ?', answer: '36', reward: 'ì •ë‹µ!\në¹„ìƒ í†µë¡œ ë¹„ë°€ë²ˆí˜¸ì˜ ì²« ë²ˆì§¸ ìë¦¬ ìˆ«ìëŠ” [ 6 ] ì…ë‹ˆë‹¤.', pos: { x: 36, y: 68, w: 29.5, h: 22.4 } }, { id: 'main_screen', type: 'problem', title: 'ë©”ì¸ ìŠ¤í¬ë¦°', text: 'ë©”ì¸ ìŠ¤í¬ë¦°ì˜ ì‹œìŠ¤í…œ ë¡œê·¸ë¥¼ ë¶„ì„í•˜ë‹ˆ ë¬¸ì œê°€ ìˆ¨ê²¨ì ¸ ìˆë‹¤.\n\n1ë¶€í„° 10ê¹Œì§€ì˜ ì§ìˆ˜ë¥¼ ëª¨ë‘ ë”í•˜ë©´ ì–¼ë§ˆì…ë‹ˆê¹Œ?', answer: '30', reward: 'ë¡œê·¸ ë¶„ì„ ì™„ë£Œ!\në¹„ìƒ í†µë¡œ ë¹„ë°€ë²ˆí˜¸ì˜ ë‘ ë²ˆì§¸ ìë¦¬ ìˆ«ìëŠ” [ 3 ] ì…ë‹ˆë‹¤.', pos: { x: 25.1, y: 28, w: 50, h: 40.5 } }, { id: 'clock_minigame', type: 'minigame', title: 'ë¹„ìƒ ì‹œê³„', text: 'ë¹„ìƒ ì‹œê³„ì˜ ë®ê°œë¥¼ ì—´ì ì‘ì€ ë©”ëª¨ë¦¬ ì¥ì¹˜ê°€ ë³´ì¸ë‹¤. í™œì„±í™”ì‹œì¼œ íŒíŠ¸ë¥¼ ì–»ì.', symbols: ['â°', 'â±ï¸', 'âŒ›ï¸', 'â³', 'ğŸ’¡', 'ğŸ””'], reward: 'ì‹œìŠ¤í…œ í™œì„±í™”!\në””ì§€í„¸ ì‹œê³„ê°€ ì ì‹œ "ë¹„ìƒ í†µë¡œ ë¹„ë°€ë²ˆí˜¸ì˜ ì„¸ ë²ˆì§¸ ìë¦¬ ìˆ«ìëŠ” [ 0 ] ì…ë‹ˆë‹¤." ë¼ëŠ” ë¬¸êµ¬ë¡œ ë°”ë€ë‹¤.', pos: { x: 44.8, y: 15.1, w: 10.4, h: 7 } } ] },
        ];

        // ë‚˜ë¨¸ì§€ JavaScript ë¡œì§ì€ ì´ì „ê³¼ ë™ì¼í•©ë‹ˆë‹¤.
        function initializeGame() { gameData = JSON.parse(JSON.stringify(gameDefinition)); }
        function startGame() {
            userInfo = { grade: userGradeInput.value || '?', class: userClassInput.value || '?', name: userNameInput.value || '?' };
            startScreen.classList.add('hidden');
            gameScreenWrapper.classList.remove('hidden');
            initializeGame();
            loadStage(currentStage);
            startTimer();
        }
        function loadStage(stageIndex) {
            gameContainer.innerHTML = '';
            if (stageIndex >= gameData.length) { endGame(); return; }
            const stage = gameData[stageIndex];
            stageDisplay.textContent = `STAGE ${stage.stage}`;
            gameContainer.style.backgroundImage = stage.backgroundImage;
            stage.hotspots.forEach(hsData => {
                const hotspotEl = document.createElement('div');
                hotspotEl.className = 'hotspot';
                hotspotEl.dataset.id = hsData.id;
                Object.assign(hotspotEl.style, { left: `${hsData.pos.x}%`, top: `${hsData.pos.y}%`, width: `${hsData.pos.w}%`, height: `${hsData.pos.h}%` });
                hotspotEl.addEventListener('click', () => onHotspotClick(hsData));
                gameContainer.appendChild(hotspotEl);
            });
        }
        function endGame() {
            stopTimer();
            gameScreenWrapper.classList.add('hidden');
            endScreen.classList.remove('hidden');
            finalUserInfo.textContent = `${userInfo.grade}í•™ë…„ ${userInfo.class}ë°˜ ${userInfo.name}`;
            const elapsedTime = new Date() - startTime;
            finalTime.textContent = formatTime(elapsedTime);
        }
        function onHotspotClick(hotspotData) {
            activeHotspot = hotspotData;
            switch(hotspotData.type) {
                case 'hint':
                    openInfoModal(hotspotData.title, hotspotData.text, false); break;
                case 'problem':
                    openInfoModal(hotspotData.title, gameData[currentStage].puzzles[activeHotspot.id] ? "ì´ë¯¸ í•´ê²°í•œ ë¬¸ì œì…ë‹ˆë‹¤." : hotspotData.text, !gameData[currentStage].puzzles[activeHotspot.id]); break;
                case 'minigame':
                    if (gameData[currentStage].puzzles[activeHotspot.id]) openInfoModal(hotspotData.title, "ì´ë¯¸ í•´ê²°í•œ ë¯¸ë‹ˆê²Œì„ì…ë‹ˆë‹¤.", false);
                    else openMinigameModal(hotspotData);
                    break;
            }
        }
        function openInfoModal(title, text, isProblem) {
            document.getElementById('info-title').textContent = title;
            document.getElementById('info-text').textContent = text;
            document.getElementById('problem-answer').value = '';
            document.getElementById('problem-input-area').classList.toggle('hidden', !isProblem);
            infoModal.classList.remove('hidden');
        }
        function openPasswordModal(title) {
            document.getElementById('password-title').textContent = title;
            passwordModal.classList.remove('hidden');
            document.getElementById('password-answer').value = '';
            document.getElementById('password-answer').focus();
        }
        function openMinigameModal(minigameData) {
            minigameModal.classList.remove('hidden');
            setupMemoryGame(minigameData);
        }
        function closeModal() { allModals.forEach(modal => modal.classList.add('hidden')); }
        function startTimer() {
            startTime = new Date();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }
        function stopTimer() { clearInterval(timerInterval); }
        function updateTimerDisplay() {
            const elapsedTime = new Date() - startTime;
            timerDisplay.textContent = formatTime(elapsedTime);
        }
        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
            const seconds = (totalSeconds % 60).toString().padStart(2, '0');
            return `${minutes}:${seconds}`;
        }
        function setupMemoryGame(minigameData) {
            const board = document.getElementById('memory-game-board');
            const currentBoard = board.cloneNode(false);
            board.parentNode.replaceChild(currentBoard, board);
            const symbols = [...minigameData.symbols, ...minigameData.symbols];
            for (let i = symbols.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [symbols[i], symbols[j]] = [symbols[j], symbols[i]]; }
            symbols.forEach(symbol => {
                const card = document.createElement('div'); card.className = 'memory-card'; card.dataset.symbol = symbol;
                card.innerHTML = `<div class="card-inner"><div class="card-face card-front">?</div><div class="card-face card-back">${symbol}</div></div>`;
                currentBoard.appendChild(card);
            });
            let flippedCards = [], matchedPairs = 0, lockBoard = false;
            currentBoard.addEventListener('click', handleCardClick);
            function handleCardClick(e) {
                const clickedCard = e.target.closest('.memory-card');
                if (!clickedCard || lockBoard || clickedCard.classList.contains('flipped') || clickedCard.classList.contains('matched')) return;
                clickedCard.classList.add('flipped');
                flippedCards.push(clickedCard);
                if (flippedCards.length === 2) {
                    lockBoard = true;
                    if (flippedCards[0].dataset.symbol === flippedCards[1].dataset.symbol) {
                        flippedCards.forEach(c => c.classList.add('matched'));
                        matchedPairs++; flippedCards = []; lockBoard = false;
                        if (matchedPairs === minigameData.symbols.length) {
                            setTimeout(() => {
                                handlePuzzleSolved(activeHotspot.reward);
                            }, 500);
                        }
                    } else { setTimeout(() => { flippedCards.forEach(c => c.classList.remove('flipped')); flippedCards = []; lockBoard = false; }, 1000); }
                }
            }
        }
        
        // **ìˆ˜ì •**: í¼ì¦ í•´ê²° í›„ ê³µí†µ ë¡œì§
        function handlePuzzleSolved(rewardText) {
            alert(rewardText);
            gameData[currentStage].puzzles[activeHotspot.id] = true;
            closeModal();
            
            // ëª¨ë“  í¼ì¦ì´ í•´ê²°ë˜ì—ˆëŠ”ì§€ í™•ì¸
            const allPuzzlesSolved = Object.values(gameData[currentStage].puzzles).every(solved => solved);
            if (allPuzzlesSolved) {
                setTimeout(() => {
                    alert('ì´ êµ¬ì—­ì˜ ëª¨ë“  ë‹¨ì„œë¥¼ ì°¾ì•˜ë‹¤! ì´ì œ íƒˆì¶œí•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.');
                    openPasswordModal("ìµœì¢… ì ê¸ˆ ì¥ì¹˜");
                }, 500);
            }
        }

        function handleProblemSubmit() {
            const answer = document.getElementById('problem-answer').value;
            if (activeHotspot && answer.toLowerCase().trim() === activeHotspot.answer.toLowerCase().trim()) {
                handlePuzzleSolved(activeHotspot.reward);
            } else { alert('í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ í•œë²ˆ í’€ì–´ë³´ì„¸ìš”.'); }
        }

        function handlePasswordSubmit() {
            const password = document.getElementById('password-answer').value;
            if (password.toLowerCase().trim() === gameData[currentStage].exitPassword.toLowerCase().trim()) {
                alert(`ìŠ¤í…Œì´ì§€ ${currentStage + 1} í´ë¦¬ì–´! ë‹¤ìŒ êµ¬ì—­ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);
                currentStage++;
                closeModal();
                loadStage(currentStage);
            } else { alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦½ë‹ˆë‹¤!'); }
        }
        
        startGameBtn.addEventListener('click', startGame);
        document.querySelectorAll('.close-button').forEach(btn => btn.addEventListener('click', closeModal));
        document.getElementById('submit-problem-btn').addEventListener('click', handleProblemSubmit);
        document.getElementById('submit-password-btn').addEventListener('click', handlePasswordSubmit);
        document.getElementById('problem-answer').addEventListener('keyup', (e) => { if(e.key ==='Enter') handleProblemSubmit() });
        document.getElementById('password-answer').addEventListener('keyup', (e) => { if(e.key ==='Enter') handlePasswordSubmit() });
    });
    </script>
</body>
</html>